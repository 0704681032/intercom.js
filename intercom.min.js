/*! intercom.js | https://github.com/diy/intercom.js | Apache License (v2) */
var Intercom=function(){var i=function(){};i.prototype.on=function(a,c){"undefined"===typeof this.handlers&&(this.handlers={});this.handlers.hasOwnProperty(a)||(this.handlers[a]=[]);this.handlers[a].push(c);for(var b=["event:on"],d=0;d<arguments.length;d++)b.push(arguments[d]);this.trigger.apply(this,b)};i.prototype.off=function(a,c){if("undefined"!==typeof this.handlers&&this.handlers.hasOwnProperty(a))for(var b=this.handlers[a].length-1;0<=b;b--)this.handlers[a][b]===c&&this.handlers[a].splice(b,
1)};i.prototype.trigger=function(a){if("undefined"!==typeof this.handlers&&this.handlers.hasOwnProperty(a))for(var c=Array.prototype.slice.call(arguments,1),b=0;b<this.handlers[a].length;b++)this.handlers[a][b].apply(this.handlers[a][b],c)};var f=window.localStorage;"undefined"===typeof f&&(f={getItem:function(){},setItem:function(){}});var h={},g=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};h.guid=function(){return g()+g()+"-"+g()+"-"+g()+"-"+g()+"-"+g()+g()+g()};h.extend=
function(a,c){if("undefined"===typeof a||!a)a={};if("object"===typeof c)for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);return a};var e=function(){var a=this,c=(new Date).getTime();this.key="intercom";this.origin=h.guid();this.lastCleanup=this.lastMessage=c;this.bindings=[];this.receivedIDs={};window.addEventListener("storage",function(){a._onStorageEvent.apply(a,arguments)})};e.prototype._cleanup=function(){var a=(new Date).getTime();if(!(50>a-this.lastCleanup)){this.lastCleanup=a;var a=a-1E3,c=
JSON.parse(f.getItem(this.key)||"[]");if(c.length){for(var b=0,d=c.length-1;0<=d;d--)c[d].timestamp<a&&(c.splice(d,1),b++);0<b&&f.setItem(this.key,JSON.stringify(c))}}};e.prototype._onStorageEvent=function(a){var c=(new Date).getTime(),a=a&&a.key;if(!a||a===this.key){for(var a=JSON.parse(f.getItem(this.key)||"[]"),b=0;b<a.length;b++)if(a[b].origin!==this.origin&&!(a[b].timestamp<this.lastMessage)){if(a[b].id){if(this.receivedIDs.hasOwnProperty(a[b].id))continue;this.receivedIDs.push(a[b].id)}this.trigger(a[b].name,
a[b].payload)}this.lastMessage=c}this._cleanup()};e.prototype._emit=function(a,c,b){if((b="string"===typeof b||"number"===typeof b?String(b):null)&&b.length){if(this.receivedIDs.hasOwnProperty(b))return;this.receivedIDs[b]=!0}var b={id:b,name:a,origin:this.origin,timestamp:(new Date).getTime(),payload:c},d=f.getItem(this.key)||"[]",d=[d.substring(0,d.length-1),"[]"===d?"":",",JSON.stringify(b),"]"].join("");f.setItem(this.key,d);this.trigger(a,c)};e.prototype.bind=function(a,c){for(var b=0;b<e.bindings.length;b++){var d=
e.bindings[b].factory(a,c||null,this);d&&this.bindings.push(d)}};e.prototype.emit=function(a,c){this._emit.apply(this,arguments);this.trigger("intercom:emit",a,c)};h.extend(e.prototype,i.prototype);e.bindings=[];e.supported="undefined"!==typeof f;var j=function(a,c,b){c=h.extend({id:null,send:!0,receive:!0},c);if(c.receive){var d=[],e=function(e){-1===d.indexOf(e)&&(d.push(e),a.on(e,function(a){var d="function"===typeof c.id?c.id(e,a):null,f="function"===typeof c.receive?c.receive(e,a):!0;(f||"boolean"!==
typeof f)&&b._emit(e,a,d)}))},f;for(f in b.handlers)for(var g=0;g<b.handlers[f].length;g++)e(f,b.handlers[f][g]);b.on("event:on",e)}if(c.send)b.on("intercom:emit",function(b,d){var e="function"===typeof c.send?c.send(b,d):!0;(e||"boolean"!==typeof e)&&a.emit(b,d)})};j.factory=function(a,c,b){return"undefined"===typeof a.socket?!1:new j(a,c,b)};e.bindings.push(j);return e}();
