var Intercom=function(){var g=function(){};g.prototype.on=function(a,c){"undefined"===typeof this.handlers&&(this.handlers={});this.handlers.hasOwnProperty(a)||(this.handlers[a]=[]);this.handlers[a].push(c);for(var b=["event:on"],d=0;d<arguments.length;d++)b.push(arguments[d]);this.trigger.apply(this,b)};g.prototype.off=function(a,c){if("undefined"!==typeof this.handlers&&this.handlers.hasOwnProperty(a))for(var b=this.handlers[a].length-1;0<=b;b--)this.handlers[a][b]===c&&this.handlers[a].splice(b,
1)};g.prototype.trigger=function(a){if("undefined"!==typeof this.handlers&&this.handlers.hasOwnProperty(a))for(var c=Array.prototype.slice.call(arguments,1),b=0;b<this.handlers[a].length;b++)this.handlers[a][b].apply(this.handlers[a][b],c)};var h={},f=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};h.guid=function(){return f()+f()+"-"+f()+"-"+f()+"-"+f()+"-"+f()+f()+f()};h.extend=function(a,c){for(var b in c)c.hasOwnProperty(b)&&(a[b]=c[b]);return a};var e=function(){var a=
this,c=(new Date).getTime();this.key="intercom";this.origin=h.guid();this.lastCleanup=this.lastMessage=c;this.bindings=[];window.addEventListener("storage",function(){a._onStorageEvent.apply(a,arguments)})};e.prototype._cleanup=function(){var a=(new Date).getTime();if(!(50>a-this.lastCleanup)){this.lastCleanup=a;var a=a-1E3,c=JSON.parse(localStorage.getItem(this.key)||"[]");if(c.length){for(var b=0,d=c.length-1;0<=d;d--)c[d].timestamp<a&&(c.splice(d,1),b++);0<b&&localStorage.setItem(this.key,JSON.stringify(c))}}};
e.prototype._onStorageEvent=function(a){var c=(new Date).getTime(),a=a&&a.key;if(!a||a===this.key){for(var a=JSON.parse(localStorage.getItem(this.key)||"[]"),b=0;b<a.length;b++)a[b].origin!==this.origin&&!(a[b].timestamp<this.lastMessage)&&this.trigger(a[b].name,a[b].payload);this.lastMessage=c}this._cleanup()};e.prototype._emit=function(a,c){var b={name:a,origin:this.origin,timestamp:(new Date).getTime(),payload:c},d=localStorage.getItem(this.key)||"[]",d=[d.substring(0,d.length-1),"[]"===d?"":",",
JSON.stringify(b),"]"].join("");localStorage.setItem(this.key,d);this.trigger(a,c)};e.prototype.bind=function(a,c){for(var b=0;b<e.bindings.length;b++){var d=e.bindings[b].factory(a,c||null,this);d&&this.bindings.push(d)}};e.prototype.emit=function(a,c){this._emit.apply(this,arguments);this.trigger("intercom:emit",a,c)};h.extend(e.prototype,g.prototype);e.bindings=[];e.supported="undefined"!==typeof localStorage;var i=function(a,c,b){var d=[],c=function(c){-1===d.indexOf(c)&&(d.push(c),a.on(c,function(a){b._emit(c,
a)}))},e;for(e in b.handlers)for(var f=0;f<b.handlers[e].length;f++)c(e,b.handlers[e][f]);b.on("event:on",c);b.on("intercom:emit",function(b,c){a.emit(b,c)})};i.factory=function(a,c,b){return"undefined"===typeof a.socket?!1:new i(a,c,b)};e.bindings.push(i);return e}();
