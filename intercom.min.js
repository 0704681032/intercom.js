/*! intercom.js | https://github.com/diy/intercom.js | Apache License (v2) */
var Intercom=function(){var k=function(){};k.prototype.on=function(b,c){"undefined"===typeof this.handlers&&(this.handlers={});this.handlers.hasOwnProperty(b)||(this.handlers[b]=[]);this.handlers[b].push(c);for(var a=["event:on"],d=0;d<arguments.length;d++)a.push(arguments[d]);this.trigger.apply(this,a)};k.prototype.off=function(b,c){if("undefined"!==typeof this.handlers&&this.handlers.hasOwnProperty(b))for(var a=this.handlers[b].length-1;0<=a;a--)this.handlers[b][a]===c&&this.handlers[b].splice(a,
1)};k.prototype.trigger=function(b){if("undefined"!==typeof this.handlers&&this.handlers.hasOwnProperty(b))for(var c=Array.prototype.slice.call(arguments,1),a=0;a<this.handlers[b].length;a++)this.handlers[b][a].apply(this.handlers[b][a],c)};var f=window.localStorage;"undefined"===typeof f&&(f={getItem:function(){},setItem:function(){},removeItem:function(){}});var i={},g=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};i.guid=function(){return g()+g()+"-"+g()+"-"+g()+"-"+g()+
"-"+g()+g()+g()};i.extend=function(b,c){if("undefined"===typeof b||!b)b={};if("object"===typeof c)for(var a in c)c.hasOwnProperty(a)&&(b[a]=c[a]);return b};var e=function(){var b=this,c=(new Date).getTime();this.origin=i.guid();this.lastCleanup=this.lastMessage=c;this.bindings=[];this.receivedIDs={};window.addEventListener("storage",function(){b._onStorageEvent.apply(b,arguments)})};e.prototype._cleanup_emit=function(){for(var b=(new Date).getTime()-1E3,c=0,a=JSON.parse(f.getItem(h)||"[]"),d=a.length-
1;0<=d;d--)a[d].timestamp<b&&(a.splice(d,1),c++);0<c&&f.setItem(h,JSON.stringify(a))};e.prototype._cleanup_once=function(){var b=(new Date).getTime()-36E5,c=0,a=JSON.parse(f.getItem(j)||"{}"),d;for(d in a)a.hasOwnProperty(d)&&a[d]<b&&(delete a[d],c++);0<c&&f.setItem(j,JSON.stringify(a))};e.prototype._cleanup=function(){var b=(new Date).getTime();50>b-this.lastCleanup||(this.lastCleanup=b,this._cleanup_emit(),this._cleanup_once())};e.prototype._onStorageEvent=function(b){var c=(new Date).getTime(),
b=b&&b.key;if(!b||b===h){for(var b=JSON.parse(f.getItem(h)||"[]"),a=0;a<b.length;a++)if(b[a].origin!==this.origin&&!(b[a].timestamp<this.lastMessage)){if(b[a].id){if(this.receivedIDs.hasOwnProperty(b[a].id))continue;this.receivedIDs.push(b[a].id)}this.trigger(b[a].name,b[a].payload)}this.lastMessage=c}this._cleanup()};e.prototype._emit=function(b,c,a){if((a="string"===typeof a||"number"===typeof a?String(a):null)&&a.length){if(this.receivedIDs.hasOwnProperty(a))return;this.receivedIDs[a]=!0}var a=
{id:a,name:b,origin:this.origin,timestamp:(new Date).getTime(),payload:c},d=f.getItem(h)||"[]",d=[d.substring(0,d.length-1),"[]"===d?"":",",JSON.stringify(a),"]"].join("");f.setItem(h,d);this.trigger(b,c)};e.prototype.bind=function(b,c){for(var a=0;a<e.bindings.length;a++){var d=e.bindings[a].factory(b,c||null,this);d&&this.bindings.push(d)}};e.prototype.emit=function(b,c){this._emit.apply(this,arguments);this.trigger("intercom:emit",b,c)};e.prototype.once=function(b,c){if(e.supported){var a=JSON.parse(f.getItem(j)||
"{}");a.hasOwnProperty(b)||(a[b]=(new Date).getTime(),f.setItem(j,JSON.stringify(a)),c())}};i.extend(e.prototype,k.prototype);e.bindings=[];e.supported="undefined"!==typeof f;var h="intercom",j="intercom_once";e.destroy=function(){f.removeItem(h);f.removeItem(j)};var l=function(b,c,a){c=i.extend({id:null,send:!0,receive:!0},c);if(c.receive){var d=[],e=function(e){-1===d.indexOf(e)&&(d.push(e),b.on(e,function(b){var d="function"===typeof c.id?c.id(e,b):null,f="function"===typeof c.receive?c.receive(e,
b):!0;(f||"boolean"!==typeof f)&&a._emit(e,b,d)}))},f;for(f in a.handlers)for(var g=0;g<a.handlers[f].length;g++)e(f,a.handlers[f][g]);a.on("event:on",e)}if(c.send)a.on("intercom:emit",function(a,d){var e="function"===typeof c.send?c.send(a,d):!0;(e||"boolean"!==typeof e)&&b.emit(a,d)})};l.factory=function(b,c,a){return"undefined"===typeof b.socket?!1:new l(b,c,a)};e.bindings.push(l);return e}();
