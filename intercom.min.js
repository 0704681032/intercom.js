/*! intercom.js | https://github.com/diy/intercom.js | Apache License (v2) */
var Intercom=function(){var l=function(){};l.prototype.on=function(b,c){"undefined"===typeof this.handlers&&(this.handlers={});this.handlers.hasOwnProperty(b)||(this.handlers[b]=[]);this.handlers[b].push(c);for(var a=["event:on"],e=0;e<arguments.length;e++)a.push(arguments[e]);this.trigger.apply(this,a)};l.prototype.off=function(b,c){if("undefined"!==typeof this.handlers&&this.handlers.hasOwnProperty(b))for(var a=this.handlers[b].length-1;0<=a;a--)this.handlers[b][a]===c&&this.handlers[b].splice(a,
1)};l.prototype.trigger=function(b){if("undefined"!==typeof this.handlers&&this.handlers.hasOwnProperty(b))for(var c=Array.prototype.slice.call(arguments,1),a=0;a<this.handlers[b].length;a++)this.handlers[b][a].apply(this.handlers[b][a],c)};var f=window.localStorage;"undefined"===typeof f&&(f={getItem:function(){},setItem:function(){},removeItem:function(){}});var j={},h=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};j.guid=function(){return h()+h()+"-"+h()+"-"+h()+"-"+h()+
"-"+h()+h()+h()};j.extend=function(b,c){if("undefined"===typeof b||!b)b={};if("object"===typeof c)for(var a in c)c.hasOwnProperty(a)&&(b[a]=c[a]);return b};var d=function(){var b=this,c=(new Date).getTime();this.origin=j.guid();this.lastCleanup=this.lastMessage=c;this.bindings=[];this.receivedIDs={};window.addEventListener("storage",function(){b._onStorageEvent.apply(b,arguments)})};d.prototype._transaction=function(b){var c=this,a=!1,e=!1,n=null,g=function(){if(!a){var d=(new Date).getTime(),p=parseInt(f.getItem(m)||
0);p&&1E3>d-p?(e||(c.on("intercom:storage",g),e=!0),n=window.setTimeout(g,20)):(a=!0,f.setItem(m,d),b(),e&&c.off("intercom:storage",g),n&&window.clearTimeout(n),f.removeItem(m))}};g()};d.prototype._cleanup_emit=function(){this._transaction(function(){for(var b=(new Date).getTime()-5E4,c=0,a=JSON.parse(f.getItem(i)||"[]"),e=a.length-1;0<=e;e--)a[e].timestamp<b&&(a.splice(e,1),c++);0<c&&f.setItem(i,JSON.stringify(a))})};d.prototype._cleanup_once=function(){this._transaction(function(){var b=(new Date).getTime()-
36E5,c=0,a=JSON.parse(f.getItem(k)||"{}"),e;for(e in a)a.hasOwnProperty(e)&&a[e]<b&&(delete a[e],c++);0<c&&f.setItem(k,JSON.stringify(a))})};d.prototype._cleanup=function(){var b=(new Date).getTime();50>b-this.lastCleanup||(this.lastCleanup=b,this._cleanup_emit(),this._cleanup_once())};d.prototype._onStorageEvent=function(b){var c=b&&b.key,a=this;(!c||c===i)&&this._transaction(function(){for(var b=(new Date).getTime(),c=f.getItem(i),c=JSON.parse(c||"[]"),g=0;g<c.length;g++)if(c[g].origin!==a.origin&&
!(c[g].timestamp<a.lastMessage)){if(c[g].id){if(a.receivedIDs.hasOwnProperty(c[g].id))continue;a.receivedIDs[c[g].id]=!0}a.trigger(c[g].name,c[g].payload)}a.lastMessage=b});window.setTimeout(function(){a._cleanup()},50);this.trigger("intercom:storage",b)};d.prototype._emit=function(b,c,a){if((a="string"===typeof a||"number"===typeof a?String(a):null)&&a.length){if(this.receivedIDs.hasOwnProperty(a))return;this.receivedIDs[a]=!0}var e={id:a,name:b,origin:this.origin,timestamp:(new Date).getTime(),
payload:c},d=this;this._transaction(function(){var a=f.getItem(i)||"[]",a=[a.substring(0,a.length-1),"[]"===a?"":",",JSON.stringify(e),"]"].join("");f.setItem(i,a);d.trigger(b,c)})};d.prototype.bind=function(b,c){for(var a=0;a<d.bindings.length;a++){var e=d.bindings[a].factory(b,c||null,this);e&&this.bindings.push(e)}};d.prototype.emit=function(b,c){this._emit.apply(this,arguments);this.trigger("intercom:emit",b,c)};d.prototype.once=function(b,c){d.supported&&this._transaction(function(){var a=JSON.parse(f.getItem(k)||
"{}");a.hasOwnProperty(b)||(a[b]=(new Date).getTime(),f.setItem(k,JSON.stringify(a)),c())})};j.extend(d.prototype,l.prototype);d.bindings=[];d.supported="undefined"!==typeof f;var i="intercom",k="intercom_once",m="intercom_lock";d.destroy=function(){f.removeItem(m);f.removeItem(i);f.removeItem(k)};var o=function(b,c,a){c=j.extend({id:null,send:!0,receive:!0},c);if(c.receive){var e=[],d=function(d){-1===e.indexOf(d)&&(e.push(d),b.on(d,function(b){var e="function"===typeof c.id?c.id(d,b):null,f="function"===
typeof c.receive?c.receive(d,b):!0;(f||"boolean"!==typeof f)&&a._emit(d,b,e)}))},g;for(g in a.handlers)for(var f=0;f<a.handlers[g].length;f++)d(g,a.handlers[g][f]);a.on("event:on",d)}if(c.send)a.on("intercom:emit",function(a,d){var e="function"===typeof c.send?c.send(a,d):!0;(e||"boolean"!==typeof e)&&b.emit(a,d)})};o.factory=function(b,c,a){return"undefined"===typeof b.socket?!1:new o(b,c,a)};d.bindings.push(o);return d}();
