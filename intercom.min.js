/*! intercom.js | https://github.com/diy/intercom.js | Apache License (v2) */
var Intercom=function(){var g=function(){};g.createInterface=function(a){return{on:function(b,c){"undefined"===typeof this[a]&&(this[a]={});this[a].hasOwnProperty(b)||(this[a][b]=[]);this[a][b].push(c)},off:function(b,c){"undefined"!==typeof this[a]&&this[a].hasOwnProperty(b)&&i.removeItem(c,this[a][b])},trigger:function(b){if("undefined"!==typeof this[a]&&this[a].hasOwnProperty(b))for(var c=Array.prototype.slice.call(arguments,1),f=0;f<this[a][b].length;f++)this[a][b][f].apply(this[a][b][f],c)}}};
var m=g.createInterface("_handlers");g.prototype._on=m.on;g.prototype._off=m.off;g.prototype._trigger=m.trigger;var n=g.createInterface("handlers");g.prototype.on=function(){n.on.apply(this,arguments);Array.prototype.unshift.call(arguments,"on");this._trigger.apply(this,arguments)};g.prototype.off=n.off;g.prototype.trigger=n.trigger;var e=window.localStorage;"undefined"===typeof e&&(e={getItem:function(){},setItem:function(){},removeItem:function(){}});var i={},h=function(){return(65536*(1+Math.random())|
0).toString(16).substring(1)};i.guid=function(){return h()+h()+"-"+h()+"-"+h()+"-"+h()+"-"+h()+h()+h()};i.throttle=function(a,b){var c=0;return function(){var f=(new Date).getTime();f-c>a&&(c=f,b.apply(this,arguments))}};i.extend=function(a,b){if("undefined"===typeof a||!a)a={};if("object"===typeof b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};i.removeItem=function(a,b){for(var c=b.length-1;0<=c;c--)b[c]===a&&b.splice(c,1);return b};var d=function(){var a=this,b=(new Date).getTime();
this.origin=i.guid();this.lastMessage=b;this.bindings=[];this.receivedIDs={};this.previousValues={};b=function(){a._onStorageEvent.apply(a,arguments)};window.attachEvent?document.attachEvent("onstorage",b):window.addEventListener("storage",b,!1)};d.prototype._transaction=function(a){var b=this,c=!1,f=!1,o=null,d=function(){if(!c){var g=(new Date).getTime(),q=parseInt(e.getItem(l)||0);q&&1E3>g-q?(f||(b._on("storage",d),f=!0),o=window.setTimeout(d,20)):(c=!0,e.setItem(l,g),a(),f&&b._off("storage",d),
o&&window.clearTimeout(o),e.removeItem(l))}};d()};d.prototype._cleanup_emit=i.throttle(100,function(){this._transaction(function(){for(var a=(new Date).getTime()-5E4,b=0,c=JSON.parse(e.getItem(j)||"[]"),f=c.length-1;0<=f;f--)c[f].timestamp<a&&(c.splice(f,1),b++);0<b&&e.setItem(j,JSON.stringify(c))})});d.prototype._cleanup_once=i.throttle(100,function(){this._transaction(function(){var a=(new Date).getTime()-36E5,b=0,c=JSON.parse(e.getItem(k)||"{}"),f;for(f in c)c.hasOwnProperty(f)&&c[f]<a&&(delete c[f],
b++);0<b&&e.setItem(k,JSON.stringify(c))})});d.prototype._localStorageChanged=function(a,b){if(a&&a.key)return a.key===b;var c=e.getItem(b);if(c===this.previousValues[b])return!1;this.previousValues[b]=c;return!0};d.prototype._onStorageEvent=function(a){var a=a||window.event,b=this;this._localStorageChanged(a,j)&&this._transaction(function(){for(var c=(new Date).getTime(),a=e.getItem(j),a=JSON.parse(a||"[]"),d=0;d<a.length;d++)if(a[d].origin!==b.origin&&!(a[d].timestamp<b.lastMessage)){if(a[d].id){if(b.receivedIDs.hasOwnProperty(a[d].id))continue;
b.receivedIDs[a[d].id]=!0}b.trigger(a[d].name,a[d].payload)}b.lastMessage=c});this._trigger("storage",a)};d.prototype._emit=function(a,b,c){if((c="string"===typeof c||"number"===typeof c?String(c):null)&&c.length){if(this.receivedIDs.hasOwnProperty(c))return;this.receivedIDs[c]=!0}var d={id:c,name:a,origin:this.origin,timestamp:(new Date).getTime(),payload:b},g=this;this._transaction(function(){var c=e.getItem(j)||"[]",c=[c.substring(0,c.length-1),"[]"===c?"":",",JSON.stringify(d),"]"].join("");e.setItem(j,
c);g.trigger(a,b);window.setTimeout(function(){g._cleanup_emit()},50)})};d.prototype.bind=function(a,b){for(var c=0;c<d.bindings.length;c++){var f=d.bindings[c].factory(a,b||null,this);f&&this.bindings.push(f)}};d.prototype.emit=function(a,b){this._emit.apply(this,arguments);this._trigger("emit",a,b)};d.prototype.once=function(a,b){if(d.supported){var c=this;this._transaction(function(){var d=JSON.parse(e.getItem(k)||"{}");d.hasOwnProperty(a)||(d[a]=(new Date).getTime(),e.setItem(k,JSON.stringify(d)),
b(),window.setTimeout(function(){c._cleanup_once()},50))})}};i.extend(d.prototype,g.prototype);d.bindings=[];d.supported="undefined"!==typeof e;var j="intercom",k="intercom_once",l="intercom_lock";d.destroy=function(){e.removeItem(l);e.removeItem(j);e.removeItem(k)};var p=function(a,b,c){b=i.extend({id:null,send:!0,receive:!0},b);if(b.receive){var d=[],e=function(e){-1===d.indexOf(e)&&(d.push(e),a.on(e,function(a){var d="function"===typeof b.id?b.id(e,a):null,f="function"===typeof b.receive?b.receive(e,
a):!0;(f||"boolean"!==typeof f)&&c._emit(e,a,d)}))},g;for(g in c.handlers)for(var h=0;h<c.handlers[g].length;h++)e(g,c.handlers[g][h]);c._on("on",e)}b.send&&c._on("emit",function(c,d){var e="function"===typeof b.send?b.send(c,d):!0;(e||"boolean"!==typeof e)&&a.emit(c,d)})};p.factory=function(a,b,c){return"undefined"===typeof a.socket?!1:new p(a,b,c)};d.bindings.push(p);return d}();
