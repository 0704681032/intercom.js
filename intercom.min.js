/*! intercom.js | https://github.com/diy/intercom.js | Apache License (v2) */
var Intercom=function(){var g=function(){};g.createInterface=function(c){return{on:function(a,b){"undefined"===typeof this[c]&&(this[c]={});this[c].hasOwnProperty(a)||(this[c][a]=[]);this[c][a].push(b)},off:function(a,b){"undefined"!==typeof this[c]&&this[c].hasOwnProperty(a)&&h.removeItem(b,this[c][a])},trigger:function(a){if("undefined"!==typeof this[c]&&this[c].hasOwnProperty(a))for(var b=Array.prototype.slice.call(arguments,1),e=0;e<this[c][a].length;e++)this[c][a][e].apply(this[c][a][e],b)}}};
var m=g.createInterface("_handlers");g.prototype._on=m.on;g.prototype._off=m.off;g.prototype._trigger=m.trigger;var n=g.createInterface("handlers");g.prototype.on=function(){n.on.apply(this,arguments);Array.prototype.unshift.call(arguments,"on");this._trigger.apply(this,arguments)};g.prototype.off=n.off;g.prototype.trigger=n.trigger;var f=window.localStorage;"undefined"===typeof f&&(f={getItem:function(){},setItem:function(){},removeItem:function(){}});var h={},i=function(){return(65536*(1+Math.random())|
0).toString(16).substring(1)};h.guid=function(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()};h.throttle=function(c,a){return function(){(new Date).getTime()-0>c&&a.apply(this,arguments)}};h.extend=function(c,a){if("undefined"===typeof c||!c)c={};if("object"===typeof a)for(var b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};h.removeItem=function(c,a){for(var b=a.length-1;0<=b;b--)a[b]===c&&a.splice(b,1);return a};var d=function(){var c=this,a=(new Date).getTime();this.origin=h.guid();
this.lastMessage=a;this.bindings=[];this.receivedIDs={};this.previousValues={};a=function(){c._onStorageEvent.apply(c,arguments)};window.attachEvent?document.attachEvent("onstorage",a):window.addEventListener("storage",a,!1)};d.prototype._transaction=function(c){var a=this,b=!1,e=!1,o=null,d=function(){if(!b){var g=(new Date).getTime(),q=parseInt(f.getItem(l)||0);q&&1E3>g-q?(e||(a._on("storage",d),e=!0),o=window.setTimeout(d,20)):(b=!0,f.setItem(l,g),c(),e&&a._off("storage",d),o&&window.clearTimeout(o),
f.removeItem(l))}};d()};d.prototype._cleanup_emit=h.throttle(100,function(){this._transaction(function(){for(var c=(new Date).getTime()-5E4,a=0,b=JSON.parse(f.getItem(j)||"[]"),e=b.length-1;0<=e;e--)b[e].timestamp<c&&(b.splice(e,1),a++);0<a&&f.setItem(j,JSON.stringify(b))})});d.prototype._cleanup_once=h.throttle(100,function(){this._transaction(function(){var c=(new Date).getTime()-36E5,a=0,b=JSON.parse(f.getItem(k)||"{}"),e;for(e in b)b.hasOwnProperty(e)&&b[e]<c&&(delete b[e],a++);0<a&&f.setItem(k,
JSON.stringify(b))})});d.prototype._localStorageChanged=function(c,a){if(c&&c.key)return c.key===a;var b=f.getItem(a);if(b===this.previousValues[a])return!1;this.previousValues[a]=b;return!0};d.prototype._onStorageEvent=function(c){var c=c||window.event,a=this;this._localStorageChanged(c,j)&&this._transaction(function(){for(var c=(new Date).getTime(),e=f.getItem(j),e=JSON.parse(e||"[]"),d=0;d<e.length;d++)if(e[d].origin!==a.origin&&!(e[d].timestamp<a.lastMessage)){if(e[d].id){if(a.receivedIDs.hasOwnProperty(e[d].id))continue;
a.receivedIDs[e[d].id]=!0}a.trigger(e[d].name,e[d].payload)}a.lastMessage=c});this._trigger("storage",c)};d.prototype._emit=function(c,a,b){if((b="string"===typeof b||"number"===typeof b?String(b):null)&&b.length){if(this.receivedIDs.hasOwnProperty(b))return;this.receivedIDs[b]=!0}var e={id:b,name:c,origin:this.origin,timestamp:(new Date).getTime(),payload:a},d=this;this._transaction(function(){var b=f.getItem(j)||"[]",b=[b.substring(0,b.length-1),"[]"===b?"":",",JSON.stringify(e),"]"].join("");f.setItem(j,
b);d.trigger(c,a);window.setTimeout(function(){d._cleanup_emit()},50)})};d.prototype.bind=function(c,a){for(var b=0;b<d.bindings.length;b++){var e=d.bindings[b].factory(c,a||null,this);e&&this.bindings.push(e)}};d.prototype.emit=function(c,a){this._emit.apply(this,arguments);this._trigger("emit",c,a)};d.prototype.once=function(c,a){if(d.supported){var b=this;this._transaction(function(){var e=JSON.parse(f.getItem(k)||"{}");e.hasOwnProperty(c)||(e[c]=(new Date).getTime(),f.setItem(k,JSON.stringify(e)),
a(),window.setTimeout(function(){b._cleanup_once()},50))})}};h.extend(d.prototype,g.prototype);d.bindings=[];d.supported="undefined"!==typeof f;var j="intercom",k="intercom_once",l="intercom_lock";d.destroy=function(){f.removeItem(l);f.removeItem(j);f.removeItem(k)};var p=function(c,a,b){a=h.extend({id:null,send:!0,receive:!0},a);if(a.receive){var e=[],d=function(d){-1===e.indexOf(d)&&(e.push(d),c.on(d,function(c){var e="function"===typeof a.id?a.id(d,c):null,f="function"===typeof a.receive?a.receive(d,
c):!0;(f||"boolean"!==typeof f)&&b._emit(d,c,e)}))},f;for(f in b.handlers)for(var g=0;g<b.handlers[f].length;g++)d(f,b.handlers[f][g]);b._on("on",d)}a.send&&b._on("emit",function(b,d){var e="function"===typeof a.send?a.send(b,d):!0;(e||"boolean"!==typeof e)&&c.emit(b,d)})};p.factory=function(c,a,b){return"undefined"===typeof c.socket?!1:new p(c,a,b)};d.bindings.push(p);return d}();
